#:kivy 1.0
<PopupColor>:
    title: 'Pick a Color'
    size_hint: 1.0, 0.6
    id: popupcolor

    BoxLayout:
        orientation: 'vertical'

        ColorPicker:
            id: colorpicker
            size_hint: 1.0, 1.0

        Button:
            text: 'PICK AND CLOSE'
            color: 0.435, 0.725, 0.56, 1
            background_color: 0, 0.26, 0.27, 1
            size_hint: 1.0, 0.2
            on_press: popupcolor.on_press_dismiss(colorpicker)

<MyPopup@Popup>:
    Label:
        text: "Level exported!"
    Button:
        text: 'Close'
        on_release: root.dismiss()

<Separator>:
    size_hint_y: None
    thickness: 4
    margin: 4
    height: self.thickness + 2 * self.margin
    color: .8, .8, .8, 1
    canvas:
        Color:
            rgba: self.color
        Rectangle:
            pos: self.x + self.margin, self.y + self.margin + 1
            size: self.width - 2 * self.margin , self.thickness


<ObjectMenu>:
    id: objectMenu
    BoxLayout:
        id: mainLayout
        orientation: "vertical"
        size: root.scaleFactor,root.scaleFactor*2
        pos: (root.width-self.width,(root.height-self.height)-48)
        canvas:
            Color:
                rgba: .1, .1, .1, 1
            Rectangle:
                size: self.size[0]+4,self.size[1]+4
                pos: self.pos[0]-4,self.pos[1]-4

            Color:
                rgba: .142, .142, .142, 1
            Rectangle:
                size: self.size
                pos: self.pos
                #radius: [(root.width+root.height)/ root.scaleFactor,]

        ToggleButton:
            id: deleteBtn
            text: "Delete"
            size_hint: 1,0.2
            on_state:
                root.changeTool(self.state, "delete")

        ToggleButton:
            id: addBtn
            text: "Add"
            size_hint: 1,0.2
            on_state:
                root.changeTool(self.state, "add")
                

        Separator:
            color: 0,0,0,0

        GridLayout:
            id: inObjectMenu
            rows: 4
            spacing: 2
            #padding: 0,50,0,50
            size: self.parent.size
            pos: self.parent.pos

<EditMenu>:
    id: editMenu
    BoxLayout:
        id: mainLayout
        orientation: "vertical"
        size: root.scaleFactor,root.scaleFactor*2
        pos: (0,(root.height-self.height)-48)
        canvas:
            Color:
                rgba: .1, .1, .1, 1
            Rectangle:
                size: self.size[0]+4,self.size[1]+4
                pos: self.pos[0],self.pos[1]-4

            Color:
                rgba: .142, .142, .142, 1
            Rectangle:
                size: self.size
                pos: self.pos
                #radius: [(root.width+root.height)/ root.scaleFactor,]

        #Deleting
        Label:
            text: "Tools"
            size_hint: 1,0.15
        Button:
            id: deleteBtn
            text: "Delete object"
            size_hint: 1,0.2
            on_press:
                root.deleteObject()

        Separator:
            color: 0.5,0.5,0.5,0.8

        #Change layer position
        Label:
            text: "Layer shift"
            size_hint: 1,0.15
        BoxLayout:
            orientation: "horizontal"
            size_hint: 1,0.3

            BoxLayout:
                orientation: "vertical"
                Button:
                    text: "Up"
                    on_press:
                        root.shiftLayer(1)
                Button:
                    text: "Top"
                    on_press:
                        root.shiftLayer(1, True)
            
            Label:
                id: layerLabel
                text: "?"

            BoxLayout:
                orientation: "vertical"
                Button:
                    text: "Down"
                    on_press:
                        root.shiftLayer(-1)
                Button:
                    text: "Bottom"
                    on_press:
                        root.shiftLayer(-1, True)

        Separator:
            color: 0.5,0.5,0.5,0.8

        #Properties editing
        Label:
            text: "Properties"
            size_hint: 1,0.15
        GridLayout:
            id: inEditMenu
            rows: 4
            spacing: 2
            #padding: 0,50,0,50
            size: self.parent.size
            pos: self.parent.pos

<StateBar>:
    id: statebar

    canvas:
        Color:
            rgba: .1, .1, .1, 1
        Rectangle:
            pos: 0,0
            size: root.width, root.scaleFactor/5

    GridLayout:
        pos: 0,0
        size: root.width, root.scaleFactor/5
        cols: 3

        Label:
            id: steps
            text: "Steps: 0"
            font_size: root.scaleFactor/12.5

        Label:
            id: tool
            text: "Game state"
            font_size: root.scaleFactor/12.5

        Label:
            id: idk
            text: ""
            font_size: root.scaleFactor/12.5

<HiddenIcon_ActionPrevious@ActionPrevious>:
    title: 'Level editor'
    with_previous: False
    app_icon: 'icons/levelicon.jpg'
    app_icon_width: 40
    app_icon_height: 40

    #width: len(self.title) * 10
    #size_hint_x: None

<ToolBarEditor>:
    #Editor action bar
    BoxLayout:
        orientation: "horizontal"
        size: root.width, root.height

        #Special bar
        ActionBar:
            id: mainActionBarGame
            pos_hint: {"top": 1}

            ActionView:
                use_separator: True
                HiddenIcon_ActionPrevious:
                    title: ''
                    width: 60
                    size_hint_x: None
                    app_icon: 'icons/levelicon.jpg'
                    font_size: root.scaleFactor/12.5

                ActionButton:
                    text: 'Exit editor'
                    font_size: root.scaleFactor/12.5
                    on_press:
                        root.screen.endLevelEditor()

                #Tools
                ActionGroup:
                    mode: 'spinner'
                    text: 'Tools'
                    font_size: root.scaleFactor/12.5
                    
                    #Obect menu
                    ActionButton:
                        text: 'Tool window'
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.screen.toggleObjectMenu()

            #Common bar
            ActionView:
                HiddenIcon_ActionPrevious:
                    title: ''
                    width: 0
                    app_icon: ''
                    font_size: root.scaleFactor/12.5

                #File interaction buttons
                ActionGroup:
                    mode: 'spinner'
                    text: 'File'
                    font_size: root.scaleFactor/12.5
                    ActionButton:
                        text: 'Save File'
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.game.exportFile()
                    ActionButton:
                        text: 'Load File'
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.game.importFile()

                #View
                ActionGroup:
                    mode: 'spinner'
                    text: 'View'
                    font_size: root.scaleFactor/12.5
                    ActionButton:
                        text: 'Center Camera'
                        minimum_width: root.scaleFactor*0.8
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.game.changeCamera("center")

    	        #Reset button
                ActionButton:
                    text: 'Reset Level'
                    font_size: root.scaleFactor/12.5
                    on_press: 
                        root.game.reset()


<ToolBarGame>:
    #Game action bar
    BoxLayout:
        orientation: "horizontal"
        size: root.width, root.height

        #Special Bar
        ActionBar:
            id: mainActionBarGame
            pos_hint: {"top": 1}

            ActionView:
                use_separator: True
                HiddenIcon_ActionPrevious:
                    title: ''
                    width: 60
                    size_hint_x: None
                    app_icon: 'icons/gameicon.png'
                    font_size: root.scaleFactor/12.5

                ActionButton:
                    text: 'Level Editor'
                    font_size: root.scaleFactor/12.5
                    on_press:
                        root.screen.startLevelEditor()

                ActionButton:
                    text: 'Exit'
                    font_size: root.scaleFactor/12.5
                    on_press:
                        root.manager.transition.direction = 'right'
                        root.manager.current = 'mainmenu'

            #Common bar
            ActionView:
                HiddenIcon_ActionPrevious:
                    title: ''
                    width: 0
                    app_icon: ''
                    font_size: root.scaleFactor/12.5

                #File interaction buttons
                ActionGroup:
                    mode: 'spinner'
                    text: 'File'
                    font_size: root.scaleFactor/12.5
                    ActionButton:
                        text: 'Save File'
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.game.exportFile()
                    ActionButton:
                        text: 'Load File'
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.game.importFile()

                #View
                ActionGroup:
                    mode: 'spinner'
                    text: 'View'
                    font_size: root.scaleFactor/12.5
                    ActionButton:
                        text: 'Center Camera'
                        minimum_width: root.scaleFactor*0.8
                        font_size: root.scaleFactor/12.5
                        on_press:
                            root.game.changeCamera("center")

    	        #Reset button
                ActionButton:
                    text: 'Reset Level'
                    font_size: root.scaleFactor/12.5
                    on_press: 
                        root.game.reset()